---
product:
    videos:
        limit: {{theme_settings.productpage_videos_count}}
    reviews:
        limit: {{theme_settings.productpage_reviews_count}}
    related_products:
        limit: {{theme_settings.productpage_related_products_count}}
---
{{#partial "amp-style"}}
    {{> components/amp/products/styles }}
{{/partial}}
{{#partial "amp-scripts"}}
    <script async custom-element="amp-accordion" src="https://cdn.ampproject.org/v0/amp-accordion-0.1.js"></script>
    <script async custom-element="amp-carousel" src="https://cdn.ampproject.org/v0/amp-carousel-0.1.js"></script>
    {{#if settings.add_this.buttons}}
        <script async custom-element="amp-social-share" src="https://cdn.ampproject.org/v0/amp-social-share-0.1.js"></script>
    {{/if}}
    <script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>
    {{#if product.videos}}
        <script async custom-element="amp-youtube" src="https://cdn.ampproject.org/v0/amp-youtube-0.1.js"></script>
    {{/if}}
{{/partial}}
{{#partial "page"}}
    {{> components/amp/common/header }}
    <div>
        {{> components/amp/products/product-view}}
    </div>
    <script type="application/ld+json">
    {
        "@context": "https://schema.org/",
        "@type": "Product",
        "name": {{{JSONstringify product.title}}},
        {{#if product.sku}}"sku": "{{product.sku}}",{{/if}}
        {{#if product.mpn}}"mpn": "{{product.mpn}}",{{/if}}
        {{#if product.gtin}}"gtin{{length product.gtin}}": "{{product.gtin}}",{{/if}}
        "url" : "{{product.url}}",
        {{#if product.brand}}
        "brand": {
            "@type": "Brand",
            "url": "{{product.brand.url}}",
            "name": {{{JSONstringify product.brand.name}}}
        },
        {{/if}}
        "description": "{{encodeURI (sanitize product.description)}}",
        "image": "{{getImage product.main_image 'zoom_size' (cdn theme_settings.default_image_product)}}",
        {{#and settings.show_product_reviews product.reviews.list.length}}
        "aggregateRating": {
            "@type": "AggregateRating",
            "ratingValue": "{{product.rating}}",
            "reviewCount": "{{product.num_reviews}}"
        },
        "review": [
        {{#each product.reviews.list}}
            {
                "@type": "Review",
                "author": {
                    "@type": "Person",
                    "name": {{{JSONstringify name}}}
                },
                "datePublished": "{{date}}",
                "reviewBody": {{{JSONstringify text}}},
                "name": {{{JSONstringify title}}},
                "reviewRating": {
                    "@type": "Rating",
                    "bestRating": "5",
                    "ratingValue": "{{rating}}",
                    "worstRating": "1"
                }
            }{{#unless @last}},{{/unless}}
        {{/each}}
        ],
        {{/and}}
        "offers": {
            "@type": "Offer",
            "priceCurrency": "{{currency_selector.active_currency_code}}",
            {{#if product.price.price_range}}
            "minPrice": "{{#if product.price.price_range.min.with_tax}}{{product.price.price_range.min.with_tax.value}}{{else}}{{product.price.price_range.min.without_tax.value}}{{/if}}",
            "maxPrice": "{{#if product.price.price_range.max.with_tax}}{{product.price.price_range.max.with_tax.value}}{{else}}{{product.price.price_range.max.without_tax.value}}{{/if}}",
            {{else}}
            "price": "{{#if product.price.with_tax}}{{product.price.with_tax.value}}{{else}}{{product.price.without_tax.value}}{{/if}}",
            {{/if}}
            "itemCondition" : "https://schema.org/{{#if product.condition}}{{product.condition}}{{else}}New{{/if}}Condition",
            "availability" : "https://schema.org/{{#if product.pre_order}}PreOrder{{else if product.out_of_stock}}OutOfStock{{else if product.can_purchase '===' false}}OutOfStock{{else}}InStock{{/if}}",
            "url" : "{{product.url}}",
            "priceValidUntil": "{{moment (moment add='31536000000') 'YYYY-MM-DD' }}"
        }
    }
    </script>
    {{#if settings.amp_analytics_id}}
        <amp-analytics type="googleanalytics">
            <script type="application/json">
            {
                "vars": {
                    "account": "{{settings.amp_analytics_id}}"
                },
                "extraUrlParams": {
                    "cd1": "{{page_type}}",
                    "cd2": "{{product.id}}",
                    "cd3": "{{product.url}}",
                    "cd4": "{{product.title}}",
                    "cd5": "{{product.sku}}"
                },
                "triggers": {
                    "trackPageview": {
                        "on": "visible",
                        "request": "pageview"
                    },
                    "trackClickOnAddToCart" : {
                        "on": "click",
                        "selector": ".productView-action a, .card-title a",
                        "request": "event",
                        "vars": {
                            "eventCategory": "Product",
                            "eventAction": "Add to Cart"
                        }
                    },
                    "trackClickOnSocialLink" : {
                        "on": "click",
                        "selector": ".amp-social-share",
                        "request": "social",
                        "vars": {
                            "socialNetwork": "${socialType}",
                            "socialAction": "Share",
                            "socialTarget": "${productLink}"
                        }
                    }
                }
            }
            </script>
        </amp-analytics>
    {{/if}}
    {{> components/amp/common/footer}}
{{/partial}}
{{> layout/amp }}
